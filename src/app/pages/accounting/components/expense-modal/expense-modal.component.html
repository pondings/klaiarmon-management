<form [formGroup]="expenseAddForm">

    <div class="modal-header">
        <h4>Add Expense</h4>
        <button type="button" class="btn-close" type="button" (click)="dismiss()"></button>
    </div>

    <div class="modal-body">

        <div class="grid bs-rows-1 bs-columns-2 row-gap-1 mb-3">
            <div class="form-floating g-col-1">
                <input class="form-control form-control-sm" placeholder="Name" formControlName="name" required>
                <label for="name" class="required">Name</label>
            </div>
            <div class="form-floating g-col-1">
                <input class="form-control form-control-sm" type="number" placeholder="Amount" formControlName="amount" required>
                <label for="amount" class="required">Amount</label>
            </div>
        </div>

        <div class="grid bs-rows-1 bs-columns-2 row-gap-1 mb-1">
            <app-date-picker label="Date" [control]="dateCtrl" [maxDate]="today!"></app-date-picker>
            <app-user-selector label="Paid by" [control]="paidByCtrl" [required]="true"></app-user-selector>
        </div>

        <div class="input-checkbox d-flex align-items-center mb-2">
            <input #isPersonalDebt class="form-check-input pe-1" type="checkbox" placeholder="Is Personal Debt" 
                checked="false" formControlName="isPersonalDebt">
            <label for="isPersonalDebt" (click)="isPersonalDebt.click()">Is Personal Debt</label>
        </div>

        <div class="d-flex flex-column">
            <button class="btn btn-outline-dark add-photo-btn" (click)="addFileForm()">
                <fa-icon [icon]="faPlus"></fa-icon>
                Add Photo
            </button>

            <div formArrayName="files" class="mt-3" *ngFor="let fileForm of filesFormArr.controls; let idx = index">
                <div class="grid bs-rows-1 bs-columns-2" [formGroup]="fileForm">
                    <div class="form-floating g-col-1">
                        <input class="form-control form-control-sm" placeholder="File Name" formControlName="name" required>
                        <label class="required">File Name</label>
                    </div>
                    <div class="input-group">
                        <div class="form-floating">
                            <input formControlName="photoUrl" class="form-control form-control-sm" placeholder="File" 
                                (click)="uploadFile.click()" readonly required>
                            <label for="file" class="required">File</label>
                        </div>
                        <button *ngIf="!(fileForm.controls.photoUrl.valueChanges | async); else hasPhotoUrl" class="btn btn-outline-secondary" 
                            type="button" (click)="uploadFile.click()">
                            <fa-icon [icon]="faFileUpload"></fa-icon>
                        </button>
                        <ng-template #hasPhotoUrl>
                            <button class="btn btn-outline-secondary" type="button" (click)="viewPhoto(fileForm)">
                                <fa-icon [icon]="faEye"></fa-icon>
                            </button>
                        </ng-template>
                        <button class="btn btn-outline-secondary" type="button" (click)="removeFormArr(idx)">
                            <fa-icon [icon]="faCircleMinus"></fa-icon>
                        </button>
                        <input #uploadFile class="invisible" type="file" accept="image/*" (change)="uploadPhoto($event, fileForm)">
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-footer">
        <button class="btn btn-sm btn-outline-dark" type="button" [disabled]="!(isFormValid$ | async)" (click)="onAdd()">Add</button>
        <button class="btn btn-sm btn-outline-danger" type="button" (click)="dismiss()">Cancel</button>
    </div>

</form>